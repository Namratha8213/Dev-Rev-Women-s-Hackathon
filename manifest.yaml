version: "2"
name: "Sprint Summarizer"
description: "Automate the process of generating a sprint summary and post it to a Slack channel. This snap-in gathers sprint data, generates insights on progress, issues, and stages, and sends a summary to the Slack channel."

service_account:
  display_name: Pratheeksha S

inputs:
  organization:
    - name: organization_name
      description: Name of the organization to which the sprint belongs
      field_type: text
      is_required: false
      ui:
        display_name: Organization Name
    - name: sprint_id
      description: ID of the sprint to generate the summary for (like SPB-28)
      field_type: text
      is_required: true
      default_value: "SPB-28"
      ui:
        display_name: Sprint ID
    - name: slack_channel
      description: Slack channel where the sprint summary will be posted 
      field_type: text
      is_required: true
      default_value: "C082X2T7PG8"
      ui:
        display_name: Slack Channel

functions:
  - name: sprint_summary_function
    description: Function that fetches sprint data, generates insights, and posts the summary to Slack.

commands:
  - name: generate_sprint_summary
    namespace: devrev
    description: "Generate sprint summary and post to Slack."
    surfaces:
      - surface: discussions
        object_types:
          - issue  # Or any other relevant object type, like 'ticket' if applicable
    usage_hint: "type /generate_sprint_summary in the discussions"
    function: sprint_summary_function


# event_sources:
#     organization:
#         - name: sprint-completion-checker
#           description: Event source that triggers every 10 minutes to check if any sprint has been completed.
#           display_name: Sprint Completion Checker
#           type: timer-events
#           config:
#             # CRON expression for triggering every 10 minutes
#             cron: "*/10 * * * *"
#             metadata:
#               event_key: ten_minute_event



# automations:
#     - name: sprint_completion_automation
#       description: Automation to check for completed sprints and trigger the sprint summary generation.
#       source: sprint-completion-checker
#       event_types:
#         - timer.tick
#       function: sprint_summary_function


# outputs:
#   message:
#     type: string
#     description: Status message for the operation. It will indicate if the sprint summary was successfully posted to Slack.

# Use secrets in keyrings for external connections
# keyrings:
#   organization:
    # - name: devrev_connection
    #   display_name: DevRev API Connection
    #   description: A connection to DevRev for fetching sprint and issue data
    #   types: snap-in-secret
    #   config:
    #     url: "https://api.devrev.ai"
    #     token: "${secrets.PAT_TOKEN}"    # Referencing the secret for the API token
    # - name: slack_connection
    #   display_name: Slack connection (must be set up as dev org connection)
    #   description: The slack app connection for the organization.
    #   types:
    #     - slack-oauth-connection # The keyring type defined below

# developer_keyrings:
#   - name: slack-oauth-secret
#     description: Slack OAuth secret
#     display_name: Slack OAuth secret

# # Define keyring types for OAuth2 Slack connection
# keyring_types:
#   - id: slack-oauth-connection
#     name: Slack Connection
#     description: Slack connection
#     kind: "Oauth2"
#     scopes: 
#       - name: read
#         description: View basic information about private channels that Sprint Summarizer has been added to
#         value: groups:read
#       - name: read
#         description: App mentions read only access
#         value: app_mentions:read
#       - name: read
#         description: View basic information about public channels in a workspace.
#         value: channels:read
#       - name: write
#         description: Send messages as @Sprint Summarizer
#         value: "chat:write"
#     scope_delimiter: ","  # Space-separated scopes
#     oauth_secret: slack-oauth-secret # Developer keyring containing OAuth2 client ID and client secret
#     reference_keyring: devrev-slack-oauth # Referencing the existing Slack connection keyring
